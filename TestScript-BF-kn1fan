local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/tbao143/Library-ui/refs/heads/main/Redzhubui"))()
workspace.FallenPartsDestroyHeight = -math.huge

local Window = Library:MakeWindow({
    Title = "lava Hub | Blox Fruits ",
    SubTitle = "by: @kn1fan / lava85halst",
    LoadText = "Loading lava Hub",
    Flags = "ChaosHub_Broookhaven"
})
Window:AddMinimizeButton({
    Button = { Image = "rbxassetid://72674068736695", BackgroundTransparency = 0 },
    Corner = { CornerRadius = UDim.new(35, 1) },
})

local InfoTab = Window:MakeTab({ Title = "Info", Icon = "rbxassetid://72674068736695" })

InfoTab:AddSection({ "Script Information" })
InfoTab:AddParagraph({ "Owner / Developer:", "@kn1fan / lava85halst" })
InfoTab:AddParagraph({ "You are using:", "lava Hub Brookhaven " })
InfoTab:AddParagraph({"Your executor:", "Executor Name"})

InfoTab:AddSection({ "Rejoin" })
InfoTab:AddButton({
    Name = "Rejoin",
    Callback = function()
        local TeleportService = game:GetService("TeleportService")
        TeleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId, game.Players.LocalPlayer)
    end
})

local ChestFarm = Window:MakeTab({ Title = "Фарм сундуков", Icon = "rbxassetid://13364900349" })

ChestFarm:AddSection({ "Второе Море" })

local isRunning = false

ChestFarm:AddButton({
    Name = "запустить фарм",
    Description = "Автоматически фармит сундуки на 2 море",
    Callback = function()
        if isRunning then
            print("Фарминг уже запущен")
            return
        end
        
        -- Функция фарминга сундуков
        local function farmSecondSeaChests()
            -- Проверяем, что игрок на Втором море
            if game:GetService("Players").LocalPlayer.Data.Level.Value < 700 then
                warn("Нужно быть на Втором море (уровень 700+)")
                return
            end
            
            local Players = game:GetService("Players")
            local localPlayer = Players.LocalPlayer
            isRunning = true
            
            -- Безопасные точки для патрулирования (над землей)
            local safePatrolPoints = {
                -- Kingdom of Rose
                Vector3.new(1400, 80, 100),
                Vector3.new(1600, 80, -200),
                Vector3.new(1200, 80, -500),
                Vector3.new(800, 80, 300),
                Vector3.new(2000, 80, 600),
                
                -- Usoap's Island
                Vector3.new(-500, 80, 1200),
                Vector3.new(-800, 80, 800),
                Vector3.new(-1200, 80, 400),
                
                -- Green Zone
                Vector3.new(-1500, 80, 100),
                Vector3.new(-1800, 80, -200),
                
                -- Frozen Village
                Vector3.new(-2000, 80, -800),
                Vector3.new(-2200, 80, -500),
                
                -- Ice Castle
                Vector3.new(2500, 80, -1000),
                
                -- Safe middle points
                Vector3.new(0, 80, 0),
                Vector3.new(500, 80, 500),
                Vector3.new(-500, 80, -500)
            }
            
            -- Функция для безопасной телепортации
            local function safeTeleport(position)
                local character = localPlayer.Character
                if not character or not character:FindFirstChild("HumanoidRootPart") then
                    return false
                end
                
                -- Всегда телепортируемся на безопасную высоту
                local safePosition = Vector3.new(position.X, 80, position.Z)
                character.HumanoidRootPart.CFrame = CFrame.new(safePosition)
                wait(0.5)
                return true
            end
            
            -- Функция для поиска видимых сундуков
            local function findVisibleChests()
                local chests = {}
                local character = localPlayer.Character
                
                if not character or not character:FindFirstChild("HumanoidRootPart") then
                    return chests
                end
                
                local currentPosition = character.HumanoidRootPart.Position
                
                for _, obj in pairs(workspace:GetChildren()) do
                    if obj:IsA("Part") and (obj.Name:lower():find("chest") or obj.Name:lower():find("sunduk")) then
                        if obj:FindFirstChild("TouchInterest") then
                            -- Проверяем, что сундук над землей и в пределах видимости
                            if obj.Position.Y > 20 and obj.Position.Y < 500 then
                                local distance = (obj.Position - currentPosition).Magnitude
                                if distance < 1000 then -- Ограничиваем радиус поиска
                                    table.insert(chests, obj)
                                end
                            end
                        end
                    end
                end
                
                return chests
            end
            
            -- Функция для сбора сундука с безопасной позиции
            local function collectChestSafely(chest)
                if not chest or not chest.Parent then 
                    return false 
                end
                
                local character = localPlayer.Character
                if not character or not character:FindFirstChild("HumanoidRootPart") then
                    return false
                end
                
                -- Телепортируемся на безопасное расстояние над сундуком
                local safeCollectPosition = chest.Position + Vector3.new(0, 10, 0)
                character.HumanoidRootPart.CFrame = CFrame.new(safeCollectPosition)
                wait(0.3)
                
                -- Собираем сундук
                firetouchinterest(character.HumanoidRootPart, chest, 0)
                wait(0.05)
                firetouchinterest(character.HumanoidRootPart, chest, 1)
                wait(0.5)
                
                return true
            end
            
            -- Функция патрулирования безопасных точек
            local function safePatrol()
                local character = localPlayer.Character
                if not character or not character:FindFirstChild("HumanoidRootPart") then
                    return {}
                end
                
                for i, point in ipairs(safePatrolPoints) do
                    if not isRunning then break end
                    
                    print("Патрулируем точку " .. i)
                    
                    -- Безопасная телепортация
                    safeTeleport(point)
                    wait(2) -- Ждем загрузки
                    
                    -- Ищем сундуки
                    local chests = findVisibleChests()
                    if #chests > 0 then
                        print("Найдено сундуков в точке " .. i .. ": " .. #chests)
                        return chests
                    end
                end
                
                return {}
            end
            
            -- Основной цикл фарминга
            while isRunning do
                local character = localPlayer.Character
                if not character then
                    character = localPlayer.CharacterAdded:Wait()
                    wait(3)
                end
                
                if not character or not character:FindFirstChild("HumanoidRootPart") then
                    wait(1)
                    continue
                end
                
                -- Сначала ищем сундуки вокруг
                local chests = findVisibleChests()
                
                -- Если нет сундуков рядом - патрулируем
                if #chests == 0 then
                    print("Сундуков рядом нет, начинаем патрулирование...")
                    chests = safePatrol()
                end
                
                -- Собираем найденные сундуки
                if #chests > 0 then
                    print("Собираем " .. #chests .. " сундуков...")
                    
                    for i, chest in ipairs(chests) do
                        if not isRunning then break end
                        if not chest or not chest.Parent then continue end
                        
                        -- Дополнительная проверка позиции сундука
                        if chest.Position.Y < 20 or chest.Position.Y > 500 then
                            print("Сундук " .. i .. " в неправильной позиции, пропускаем")
                            continue
                        end
                        
                        print("Собираем сундук " .. i)
                        local success = collectChestSafely(chest)
                        
                        if success then
                            print("✓ Сундук " .. i .. " собран")
                        else
                            print("✗ Ошибка сбора сундука " .. i)
                        end
                        
                        wait(1)
                    end
                else
                    print("Сундуки не найдены, повторяем поиск...")
                end
                
                -- Короткая пауза между циклами
                wait(2)
            end
            
            print("Фарминг остановлен")
        end
        
        -- Запускаем в отдельном потоке
        spawn(farmSecondSeaChests)
    end
})

-- Кнопка остановки
ChestFarm:AddButton({
    Name = "остановить фарм",
    Description = "Останавливает фарм сундуков",
    Callback = function()
        isRunning = false
        print("Останавливаем фарминг...")
    end
})

ChestFarm:AddSection({ "Информация" })
ChestFarm:AddParagraph({"Важно:", "Скрипт использует только безопасные точки над картой"})
ChestFarm:AddParagraph({"Локации:", "Королевство Роз, Остров Усоапа, Ледяная Деревня"})
